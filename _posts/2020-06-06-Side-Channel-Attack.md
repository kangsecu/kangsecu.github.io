---
layout: post
title: "Side Channel Attack"
excerpt: "Try to know Side-Channel-Attack & use it ~_~"
categories: [system,crypto]
comments: true 
---

이제는 그동안 공부 하고 싶었던 부채널분석(Side Channel Attack)에 대해서도 공부를 해보자. 솔직히 부채널분석은 한글자료가 너무 부족하다.. 무슨 구글링을 해도 다 영문자료라 공부하는데 많이 힘들 것 같다..

>  부채널분석은 일반적으로 우리가 공격하는 취약점 분석과는 달리 어떠한 시스템이 구현될 때 소요되는 시간, 소비하는 전력, 
 방출하는 전자기파, 소리 등등의 세부적인 정보를 이용하여 정보를 얻는 방법 

예를들어 암호 체계를 파악하기 위하여 암호 알고리즘을 분석하던가, 시스템의 바이너리를 분석하여 공격하던가 하는 정통적인 공격 방식이 아닌 뭔가 약간 꼼수(?)로 정보를 획득하는 방법이다.   

부채널 분석에는 다양한 종류가 존재하는데 그중에 몇개만 알아보자.

* Timing Attack  - 시스템이 작동하는데 소요되는 시간을 측정하여 분석 
* Power Analysis - 연산 중에 HW가 소비하는 전력을 측정하여 분석
* Differential Fault Attack - 의도적으로 오류를 발생하는 연산을 하여 분석
* Electromagnetic Attack - 시스템의 HW가 외부로 방출하는 전자기파를 이용하여 분석
* Row Hammer Attack -  인접한 메모리에 접근해서 메모리 영역을 수정하는 공격

등등 다양한 종류가 있다. 뭐 추가적으로 음향을 이용한 공격도 있고, 다양하지만 우선은 이것들만 적는다.

이제 간단하게 각 방법의 예시를 들어보자.  

<hr>

### 0x0 Timing Attack 

처음으로 알아볼건 타이밍어택이다. 간단하게 설명하면 시스템이 다양한 연산을 해내는데 소요되는 시간을 측정하여  추가적인 정보를 획득하는 것. 

뭔가 웹에서 Time Base SQL Injection과 비슷한 것 같다. 예시 코드를 보자. 

main.c :

```python
def cmp(a, b):
    if len(a) != len(b):
        return False
    for c1, c2 in zip (a, b):
        if c1 != c2:
            return False
    return True
```

위의 코드를 보면 간단하게 문자열을 비교하는 기능을 한다. cmp함수가 a,b 문자열을 비교해서 동일하면 True를, 아니면 False를 반환한다.

이번 예제에서는 문자열의 길이는 공개되어 있다고 가정하자. 이제 a를 hello로 b를 melon으로 가정하면 둘의 첫글자부터 다르다.  > 즉 위의 반복문을 1회만 연산 후 False를 뱉는다. 

하지만 a=hello , b=hella를 비교할 때에는 앞의 4글자가 같기 때문에 반복문을 5회를 돈 후에 False를 뱉는다. 바로 이 과정에서 두 연산의 소요되는 시간이 차이가 발생한다. 

실제로 위의 코드는 실행시켜보면 그렇게 큰 차이가 발생하지 않는다. 하지만 섬세하게 ms단위로 측정을 하면 그 미세한 차이로 공격자는 키를 찾을 수 있게 된다. 

이번에는 간단한 예시코드로 봤지만, 다음에는 더 공부를 해서 AES같은 암호를 timing attack하는 글을 작성해볼 예정이다. 



### 0x1 Power Analysis

이번에는 소비전력을 통하여 분석을 하는 방법이다. 솔직히 이건 한글로 된 자료를 전혀 찾을 수 없었다. 단순 전력 분석인 SPA는 전기적인 그래프를 시각적으로 해석하는 것을 말하고, 

DPA는 수집된 소비전력을 통계적 분석을 통해 공격자가 암호 연산 내의 중간값을 계산할 수 있게 해준다고 한다.

SPA에서는 mcu의  각기 다른 명령들의 소비전력을 분석하며, 아무리 소비전력의 변동 폭이 작더라도 오실로스코프를 이용하여 데이터 변동을 쉽게 시각적으로 표현이 가능하다.  

예를 들어 곱셈 연산은 덧셈 연산보다 소비전력이 크기 때문에 두 함수를 소비전력으로 구분이 가능하다.

![side1](/img/side1.png)

DPA는  전력 소비량을 통계적으로 분석하는 공격인데, 비밀키로 연산을 수행하는 동안 mcu로 다양한 소비전력을 통계를 낸다.
일반적으로 SPA에서는 할 수 없는 노이즈가 너무 많거나 신호 처리나 오류 수정이 있는 측정을 DPA에서 한다고 한다. 

+ 그럼 내가 인상깊게 봤던 GRAYHASH 정구홍 연구원님의 강의중 나온 Glitching도 여기에 해당하는 건가?

이것도 더욱 공부해서 내용을 추가할 예정이다. 그리고 추가적인 분석글도 작성해보고 싶다.



### 0x2 Differential Fault Attack

DFA는 의도적으로 오류가 발생하는 연산을 하는 방법이다. 약간 의도적으로 결함으로 내부 정보를 추출하는 것이 

웹해킹에서의 Error Base SQL Injection과 비슷한 느낌이 든다. (난  사실 이미 부채널분석을 하고 있던 것 아닐까)

내장형 프로세서가 포함된 기기에 고압 전류를 넘기거나, 과도한 오버클럭이나 자기장이나 전기장, 또는 심지어 방사선까지 노출시키면

데이터가 손상되어 내부의 결함을 포함한 결과를 반환할 수 있는데 이러한 정보를 암호해독에 이용한 것.

이건 마땅한 예시가 없다.



### 0x3 Electromagnetic Attack 

이번에는 전자기파를 이용하여 분석하는 방법이다. 모든 전자기기는 전자파를 발생시키는데, 이 전자기장이 적절하게 설계되지 않은 경우에 이를 이용해서도 정보를 노출 할 수 있다.

이 전자기파는 유도 코일을 이용하여 획득 할 수 있으며, 아날로그-디지털 변환기로 주어진 클럭 속도로 전자파동을 샘플링하고 이를 추적하여 
디지털 신호로 변환하여 재전송할 수 있다.

전에 스마트카 취약점 분석을 공부하면서 자동차에서 엑셀을 밟을 때 발생하는 신호를 잡아서 분석해두고 이를 이용하여 다시 제전송할 수 있다는 것을 봤는데 비슷한 맥락인 것 같기도하다. 

우리는 암호를 해독하는데 필요한 주파수만 걸러내기 위해서 신호 러치를 하여 노이즈를 제거하고 해당 주파수를 거르는 대역폭 통과 필터를 이용해야한다. 

때로는 의심되는 모든 신호를 긁어와 스펙트럼을 그리기도 한다. 전자파 분석도 단순 전자파 분석인 SEMA와 차동 전자파 분석인 DEMA로 구분한다.

SEMA에서는 공격자가 추적되는 정보를 토대로 키를 직접 추론하는데 비대칭키 암호에 매우 효과적이다.

SEMA에 취약한 암호는 키의 비트가 1인지 0인지에 대하여 다른 작동을 수행하며 전력 분석 방법에서도 널리 사용된다.

반대로 DEMA는 대칭 암호를 공격하는데 더욱 효과적이다. 또한 DEMA는 공격 대상에 대한 많은 지식을 필요로 하지 않는다.



### 0x4 Row Hammer Attack

로우 해머 공격은  DIMM 메모리 모듈, 즉 HW에 존재하는 취약점으로, DRAM에서 cell 밀집도가 높아져서 한 row에 대한 반복적인 접근을 할 때 인접한 메모리 row에 bit flip이 발생하는 취약점이다. 

bit flip이란 동일한 메모리 행(row)에 반복적인 접근과정을 통하여 전기방해가 발생하고, 해당 메모리 행에 인접해 있는 메모리 행에 영향을 미치는 현상을 말한다.

이는 추가적으로 RAMbleed Attack에 기반이 되기도 한다.

### 0x1 Reference

부채널분석을 공부하면서 도움이 많이 된 자료들을 모아봤다. 앞으로 찾으면 다음 글이던 이번글에 더욱 추가할 예정

>공부하며 들은 생각은 약간 전자공학 쪽 공부를 하면 큰 도움이 될 것 같다. 그리고 비파괴검사를 공부하면 도움이 될까..? 아무튼 매우 흥미롭다.
 
 >그리고 뭔가 전문기기가 없으면 시도해볼 수 없는게 많아서 집에서 시도해보기엔 한계가 있는 것 같다.

Timing Attack 

https://research.kudelskisecurity.com/2013/12/13/timing-attacks-part-1/

Power Analysis

https://anysilicon.com/side-channel-attacks-differential-power-analysis-dpa-simple-power-analysis-spa-works/

Row Hammer Attack

https://github.com/google/rowhammer-test

https://www.blackhat.com/docs/us-15/materials/us-15-Seaborn-Exploiting-The-DRAM-Rowhammer-Bug-To-Gain-Kernel-Privileges.pdf

